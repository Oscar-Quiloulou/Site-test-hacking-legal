<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Page Cyber-Exemple - Encodeur Multi-mode + Chat & Historique</title>
    
    <!-- Chargement des librairies Firebase (CDN) - Mise à jour pour AUTH et FIRESTORE -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, addDoc, onSnapshot, collection, query, orderBy, serverTimestamp, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

        // ====================================================================================
        // --- FIX POUR GITHUB PAGES ET ENVIRONNEMENT PUBLIC ---
        // Les identifiants Firebase que vous avez fournis sont intégrés ci-dessous.
        // ====================================================================================

        // 1. L'ID de l'application est utilisé pour les chemins Firestore.
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id-encoder';
        
        // 2. CONFIGURATION FIREBASE PUBLIQUE (Vos identifiants spécifiques)
        // Cette configuration est utilisée lorsque l'application n'est pas dans l'environnement d'aperçu (ex: GitHub Pages).
        const publicFirebaseConfig = {
            apiKey: "AIzaSyDsKu6EavK4oEh4F2TS0EoB5HwzMxY7kgU",
            authDomain: "chat-encode.firebaseapp.com",
            databaseURL: "https://chat-encode-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "chat-encode",
            storageBucket: "chat-encode.firebasestorage.app",
            messagingSenderId: "812767464816",
            appId: "1:812767464816:web:e46750b8cfda20063c93b5",
            measurementId: "G-SFLFFQ5HPD"
        };
        
        // Utilisation de la configuration injectée (pour l'aperçu) ou de la configuration publique (pour les pages GitHub).
        const firebaseConfig = (typeof __firebase_config !== 'undefined' && __firebase_config) 
                                ? JSON.parse(__firebase_config) 
                                : publicFirebaseConfig;
        
        // 3. Le jeton d'authentification initial est ignoré en environnement public
        const initialAuthToken = null; 
        
        // ====================================================================================
        // --- FIN DE LA CONFIGURATION ---
        // ====================================================================================

        // Initialisation de Firebase avec la configuration (publique ou injectée)
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        // setLogLevel('Debug'); // Décommenter pour le debug

        let currentUserId = null;
        let publicAlias = null; 
        let isAuthReady = false;
        
        // Listes pour générer l'alias par défaut
        const ADJECTIVES = ["Agent", "Phantom", "Cipher", "Delta", "Echo", "Ghost", "Matrix", "Vortex", "Rogue", "Sigma"];
        const NOUNS = ["One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine", "Zero"];

        // --- AUTHENTIFICATION ET INITIALISATION ---
        
        function generatePublicAlias() {
            const adj = ADJECTIVES[Math.floor(Math.random() * ADJECTIVES.length)];
            const num = Math.floor(Math.random() * 90) + 10;
            return `${adj}-${num}`;
        }
        
        async function setupUserIdentity(userId) {
            // Document privé pour stocker l'alias : /artifacts/{appId}/users/{userId}/profile/data
            const profileDocRef = doc(db, `artifacts/${appId}/users/${userId}/profile/data`);
            
            try {
                const docSnap = await getDoc(profileDocRef);
                
                if (docSnap.exists() && docSnap.data().alias) {
                    publicAlias = docSnap.data().alias;
                } else {
                    publicAlias = generatePublicAlias();
                    await setDoc(profileDocRef, { 
                        alias: publicAlias,
                        createdAt: serverTimestamp()
                    });
                }
                
                // Mise à jour de l'interface
                document.getElementById('currentUserDisplay').textContent = publicAlias;
                document.getElementById('profileAliasInput').value = publicAlias;
                document.getElementById('secureIDDisplay').textContent = currentUserId;

                appendMessage(`[SYSTEM] : Connecté. Alias Public: ${publicAlias}. ID Sécurisé: ${currentUserId.substring(0, 8)}... Statut: EN LIGNE.`, 'system');
                
                // Démarrer l'écoute des données
                loadChatMessages();
                loadHistory();

            } catch (error) {
                console.error("Erreur de configuration de l'identité utilisateur:", error);
                publicAlias = 'ANONYME-FAIL';
                appendMessage(`[SYSTEM] : Erreur. ID de secours: ${currentUserId.substring(0, 8)}... Statut: EN LIGNE.`, 'system');
                loadChatMessages();
                loadHistory();
            }
        }

        // Connexion à Firebase - Simplifiée pour l'environnement public
        async function authenticateUser() {
            try {
                // Tente la connexion anonyme par défaut
                await signInAnonymously(auth);
            } catch (error) {
                // Cette erreur est corrigée car la clé API est maintenant valide
                console.error("Erreur d'authentification Firebase:", error);
                showMessageBox("ERREUR D'AUTH : Vérifiez la console et votre configuration Firebase.");
            }
        }
        
        // Écoute des changements d'état d'authentification
        onAuthStateChanged(auth, (user) => {
            isAuthReady = true;
            if (user) {
                currentUserId = user.uid;
                window.db = db;
                window.currentUserId = currentUserId;
                
                setupUserIdentity(user.uid);

            } else {
                currentUserId = 'ANONYMOUS';
                appendMessage(`[SYSTEM] : Connexion en cours...`, 'system');
                authenticateUser();
            }
        });
        
        // --- LOGIQUE CHAT ---
        
        const chatDisplay = document.getElementById('chatDisplay');
        const chatInputForm = document.getElementById('chatInputForm');
        const chatInput = document.getElementById('chatInput');

        window.appendMessage = function(message, type) {
            const msgDiv = document.createElement('div');
            const timestamp = new Date().toLocaleTimeString('fr-FR', {hour: '2-digit', minute:'2-digit', second:'2-digit'});
            msgDiv.className = `chat-message chat-${type}`;
            msgDiv.innerHTML = `[${timestamp}] ${message}`;
            chatDisplay.appendChild(msgDiv);
            chatDisplay.scrollTop = chatDisplay.scrollHeight;
        }

        function loadChatMessages() {
            if (!currentUserId || !db) return;

            const chatRef = collection(db, `artifacts/${appId}/public/data/chat_messages`);
            const chatQuery = query(chatRef, orderBy('timestamp'));

            onSnapshot(chatQuery, (snapshot) => {
                snapshot.docChanges().forEach(change => {
                    if (change.type === 'added') {
                        const data = change.doc.data();
                        const isUser = data.senderId === currentUserId;
                        
                        const senderTag = isUser ? `[${publicAlias}]` : `[${data.senderAlias || `ID:${data.senderId.substring(0, 8)}...`}]`;
                        const type = isUser ? 'user' : 'system'; 
                        appendMessage(`${senderTag} : ${data.text}`, type);
                    }
                });
            }, (error) => {
                console.error("Erreur d'écoute Firestore Chat:", error);
            });
        }
        
        chatInputForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            if (!currentUserId || !db || !publicAlias) {
                showMessageBox("Erreur : Connexion en cours. Veuillez patienter.");
                return;
            }
            
            const userMessage = chatInput.value.trim();

            if (userMessage) {
                const chatRef = collection(db, `artifacts/${appId}/public/data/chat_messages`);
                try {
                    await addDoc(chatRef, {
                        text: userMessage,
                        senderId: currentUserId,
                        senderAlias: publicAlias,
                        timestamp: serverTimestamp()
                    });
                    chatInput.value = ''; 
                } catch (error) {
                    showMessageBox("Erreur d'envoi du message.");
                    console.error("Erreur d'ajout doc Firestore:", error);
                }
            }
        });

        // --- LOGIQUE ENCODEUR ET HISTORIQUE (inchangée) ---
        
        const ALPHABET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        const ALPHABET_LENGTH = ALPHABET.length;
        const VOWELS_TO_NUM = {'A': '1', 'E': '2', 'I': '3', 'O': '4', 'U': '5'};
        const NUM_TO_VOWELS = {'1': 'A', '2': 'E', '3': 'I', '4': 'O', '5': 'U'};
        
        let currentShift = 1; 
        let activeMode = 'caesar';

        const cipherModeSelect = document.getElementById('cipherMode');
        const caesarSettingsDiv = document.getElementById('caesarSettings');
        const vowelSettingsDiv = document.getElementById('vowelSettings');
        const shiftAmountInput = document.getElementById('shiftAmount');
        const currentShiftDisplay = document.getElementById('currentShiftDisplay');
        const aTargetDisplay = document.getElementById('aTargetDisplay');
        const inputTextarea = document.getElementById('inputText');
        const outputTextarea = document.getElementById('outputText');
        const historyList = document.getElementById('historyList'); 

        function getShiftedChar(index, shift) {
            return ALPHABET[(index + shift) % ALPHABET_LENGTH];
        }

        function transformCaesar(text, direction) {
            let result = '';
            const shift = direction === 'encode' ? currentShift : ALPHABET_LENGTH - currentShift;
            for (let i = 0; i < text.length; i++) {
                const char = text[i].toUpperCase();
                const index = ALPHABET.indexOf(char);
                if (index !== -1) {
                    result += getShiftedChar(index, shift);
                } else {
                    result += text[i];
                }
            }
            return result;
        }

        function transformVowelSub(text, direction) {
            let mapping;
            if (direction === 'encode') {
                mapping = VOWELS_TO_NUM;
            } else {
                mapping = NUM_TO_VOWELS;
            }
            let result = '';
            for (let i = 0; i < text.length; i++) {
                const char = direction === 'encode' ? text[i].toUpperCase() : text[i];
                if (mapping[char]) {
                    result += mapping[char];
                } else {
                    result += text[i];
                }
            }
            return result;
        }

        function updateSettingsVisibility() {
            activeMode = cipherModeSelect.value;
            if (activeMode === 'caesar') {
                caesarSettingsDiv.style.display = 'block';
                vowelSettingsDiv.style.display = 'none';
                updateShiftDisplay();
            } else if (activeMode === 'vowel_sub') {
                caesarSettingsDiv.style.display = 'none';
                vowelSettingsDiv.style.display = 'block';
            }
        }
        
        function updateShiftDisplay() {
            currentShiftDisplay.textContent = currentShift;
            aTargetDisplay.textContent = getShiftedChar(0, currentShift); 
        }

        async function saveHistoryEntry(action, input, output, mode, shift = null) {
            if (!currentUserId || !db) {
                console.error("Impossible de sauvegarder : Utilisateur non authentifié ou DB non prête.");
                return;
            }
            
            const historyRef = collection(db, `artifacts/${appId}/users/${currentUserId}/encoding_history`);
            try {
                await addDoc(historyRef, {
                    action,
                    input: input.substring(0, 100), 
                    output: output.substring(0, 100),
                    mode,
                    shift,
                    timestamp: serverTimestamp()
                });
            } catch (error) {
                console.error("Erreur de sauvegarde de l'historique:", error);
            }
        }

        function loadHistory() {
            if (!currentUserId || !db) return;

            const historyRef = collection(db, `artifacts/${appId}/users/${currentUserId}/encoding_history`);
            const historyQuery = query(historyRef, orderBy('timestamp', 'desc'));

            onSnapshot(historyQuery, (snapshot) => {
                historyList.innerHTML = ''; 
                snapshot.docs.forEach(doc => {
                    const data = doc.data();
                    const li = document.createElement('li');
                    
                    let shiftInfo = data.mode === 'caesar' ? ` (Clé: ${data.shift})` : '';
                    let actionText = data.action === 'encode' ? 'ENCODE' : 'DÉCODE';
                    let actionColor = data.action === 'encode' ? 'var(--accent)' : '#8b5cf6';
                    
                    li.style.cssText = `border-bottom: 1px solid var(--border); padding: 5px 0; font-size: 0.8rem;`;
                    li.innerHTML = `
                        <span style="color:${actionColor}; font-weight:bold;">[${actionText}]</span> 
                        <span class="muted" style="margin-left: 5px;">${data.mode.toUpperCase()}${shiftInfo}</span><br>
                        Entrée: <span style="color:var(--text);">${data.input}</span> → 
                        Sortie: <span style="color:var(--text);">${data.output}</span>
                    `;
                    historyList.appendChild(li);
                });
            }, (error) => {
                console.error("Erreur d'écoute Historique Firestore:", error);
            });
        }
        
        // Événements Encode / Decode
        document.getElementById('encodeBtn').addEventListener('click', () => {
            const inputText = inputTextarea.value;
            let result = '';
            if (activeMode === 'caesar') {
                result = transformCaesar(inputText, 'encode');
                saveHistoryEntry('encode', inputText, result, 'caesar', currentShift);
            } else if (activeMode === 'vowel_sub') {
                result = transformVowelSub(inputText, 'encode');
                saveHistoryEntry('encode', inputText, result, 'vowel_sub');
            }
            outputTextarea.value = result;
        });

        document.getElementById('decodeBtn').addEventListener('click', () => {
            const inputText = inputTextarea.value;
            let result = '';
            if (activeMode === 'caesar') {
                result = transformCaesar(inputText, 'decode');
                saveHistoryEntry('decode', inputText, result, 'caesar', currentShift);
            } else if (activeMode === 'vowel_sub') {
                result = transformVowelSub(inputText, 'decode');
                saveHistoryEntry('decode', inputText, result, 'vowel_sub');
            }
            outputTextarea.value = result;
        });

        // --- GESTION DU PROFIL ---
        document.getElementById('saveProfileBtn').addEventListener('click', async function() {
            const newAlias = document.getElementById('profileAliasInput').value.trim();
            if (!newAlias || newAlias.length < 3) {
                showMessageBox("ERREUR : L'alias doit contenir au moins 3 caractères.");
                return;
            }
            
            if (newAlias.includes('/') || newAlias.includes('.')) {
                 showMessageBox("ERREUR : L'alias ne peut pas contenir de '/' ou de '.'.");
                 return;
            }

            if (!currentUserId || !db) {
                showMessageBox("Erreur : Connexion en cours.");
                return;
            }

            try {
                const profileDocRef = doc(db, `artifacts/${appId}/users/${currentUserId}/profile/data`);
                await setDoc(profileDocRef, { alias: newAlias }, { merge: true });
                
                publicAlias = newAlias;
                document.getElementById('currentUserDisplay').textContent = publicAlias;
                showMessageBox(`Alias mis à jour avec succès : ${publicAlias}`);

            } catch (error) {
                showMessageBox("ERREUR : Impossible de sauvegarder le nouvel alias.");
                console.error("Erreur de sauvegarde de l'alias:", error);
            }
        });

        // Autres événements de l'Encodeur
        cipherModeSelect.addEventListener('change', updateSettingsVisibility);

        document.getElementById('saveShift').addEventListener('click', () => {
            const newShift = parseInt(shiftAmountInput.value);
            if (newShift >= 0 && newShift < ALPHABET_LENGTH) {
                currentShift = newShift;
                updateShiftDisplay();
                showMessageBox(`Décalage activé : A → ${getShiftedChar(0, currentShift)}.`);
            } else {
                showMessageBox('ERREUR : Le décalage doit être un nombre entier entre 0 et 25.');
                shiftAmountInput.value = currentShift;
            }
        });

        document.getElementById('resetShift').addEventListener('click', () => {
            currentShift = 1;
            shiftAmountInput.value = currentShift;
            updateShiftDisplay();
            showMessageBox('Décalage réinitialisé à 1 (A → B).');
        });


        // Fonction utilitaire pour remplacer les alertes
        function showMessageBox(message) {
            const tempDiv = document.createElement('div');
            tempDiv.style.cssText = `
                position: fixed; top: 10px; right: 10px; background-color: ${message.includes('ERREUR') ? 'red' : 'var(--accent)'};
                color: var(--card); padding: 10px 15px; border-radius: var(--radius); z-index: 2000;
                box-shadow: var(--glow); font-weight: bold; animation: fadeout 5s forwards;
            `;
            tempDiv.textContent = message;
            document.body.appendChild(tempDiv);

            setTimeout(() => {
                tempDiv.remove();
            }, 5000); 
        }

        // --- Initialisation au chargement ---
        document.getElementById('year').textContent = new Date().getFullYear();
        shiftAmountInput.value = currentShift;
        updateSettingsVisibility();
    </script>
    
    <style>
        /* BASE FUTURISTE (inchangée) */
        :root{
            --bg: #141b26;      
            --card: #0d121b;    
            --accent: #00ffc4;  
            --text: #e6f7ff;    
            --muted: #5e7087;   
            --border: #2c3a50;  
            --glow: 0 0 15px rgba(0, 255, 196, 0.4); 
            --radius: 4px;
            --max: 1200px;
        }
        *{box-sizing:border-box}
        body{
            margin:0;
            font-family:'Courier New', monospace; 
            background:var(--bg);
            color:var(--text);
            -webkit-font-smoothing:antialiased;
            line-height:1.6;
            padding-bottom: 250px; 
        }
        .wrap{max-width:var(--max); margin:40px auto; padding:0 24px;}
        header{display:flex; align-items:center; justify-content:space-between; gap:20px; margin-bottom:40px; border-bottom:1px solid var(--border); padding-bottom:15px;}
        .brand{display:flex; align-items:center; gap:16px;}
        .logo{width:54px; height:54px; background:var(--accent); border-radius:var(--radius); display:inline-block; box-shadow:var(--glow);}
        .brand strong{font-size:1.4rem; color:var(--accent); text-shadow:var(--glow);}
        .brand .muted{font-size:.75rem;}
        nav ul{list-style:none; padding:0; margin:0; display:flex; gap:20px; align-items:center;}
        nav a{color:var(--muted); text-decoration:none; font-weight:700; transition:color 0.3s;}
        nav a:hover{color:var(--accent); text-shadow:var(--glow);}
        .hero{
            background:var(--card);
            padding:36px;
            border-radius:var(--radius);
            display:flex;
            gap:30px;
            align-items:center;
            margin-bottom:30px;
            border:1px solid var(--border);
            box-shadow:0 0 20px rgba(0, 255, 196, 0.1);
        }
        .hero .left{flex:1}
        .hero h1{margin:0 0 10px; font-size:2rem; color:var(--accent);}
        .hero p{margin:0 0 16px; color:var(--muted)}
        .btn{
            display:inline-block;
            background:var(--accent);
            color:var(--card);
            padding:12px 18px;
            border-radius:var(--radius);
            text-decoration:none;
            font-weight:700;
            transition: all 0.3s;
            text-transform: uppercase;
            box-shadow:var(--glow);
            border:none;
            cursor: pointer;
        }
        .btn:hover{
            background: #00ffdd;
            box-shadow: 0 0 20px rgba(0, 255, 196, 0.8);
        }
        .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; margin-bottom:30px;}
        .card{
            background:var(--card);
            padding:20px;
            border-radius:var(--radius);
            border:1px solid var(--border);
            box-shadow:0 0 10px rgba(0, 255, 196, 0.05);
        }
        .card h3{margin:0 0 10px; font-size:1.15rem; color:var(--accent);}
        .muted{color:var(--muted); font-size:0.9rem}
        .encoder-controls{
            display:flex;
            gap:10px;
            margin-top:10px;
        }
        form{display:grid; gap:12px;}
        input,textarea,select{ 
            width:100%;
            padding:12px;
            border:1px solid var(--border);
            border-radius:var(--radius);
            font-size: 1rem;
            font-family:'Courier New', monospace; 
            background:var(--bg);
            color:var(--text);
            box-shadow:inset 0 0 5px rgba(0, 255, 196, 0.1);
            transition:border-color 0.3s;
        }
        input:focus,textarea:focus,select:focus{
            outline:none;
            border-color:var(--accent);
            box-shadow:inset 0 0 10px rgba(0, 255, 196, 0.3);
        }
        #shiftAmount{
            width: 80px;
            text-align: center;
            display: inline-block;
        }
        .cipher-info{
            background: var(--bg);
            border: 1px dashed var(--border);
            padding: 10px;
            border-radius: var(--radius);
            font-size: 0.8rem;
            word-break: break-all;
        }
        .mode-settings{
            margin-top: 15px;
            padding: 15px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
        }
        footer{margin:40px 0 20px; color:var(--muted); text-align:center; font-size:0.85rem; padding-top:15px; border-top:1px dashed var(--border);}
        #chatTerminal {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 200px;
            background: var(--card); 
            border-top: 2px solid var(--accent);
            padding: 10px;
            box-shadow: 0 -5px 20px rgba(0, 255, 196, 0.15);
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }
        #chatDisplay {
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 10px;
            padding-right: 10px; 
            font-size: 0.8rem;
            color: var(--text);
        }
        #chatDisplay::-webkit-scrollbar {
            width: 8px;
        }
        #chatDisplay::-webkit-scrollbar-thumb {
            background-color: var(--muted);
            border-radius: 4px;
        }
        .chat-message {
            margin-bottom: 5px;
            line-height: 1.3;
        }
        .chat-system {
            color: var(--accent);
        }
        .chat-user {
            color: #8b5cf6; 
        }
        #chatInputForm {
            display: flex;
            gap: 10px;
        }
        #chatInput {
            flex-grow: 1;
            padding: 8px;
            height: auto;
        }
        #chatSendBtn {
            padding: 8px 15px;
            font-size: 0.8rem;
            min-width: 80px;
        }
        .security-alert {
            background-color: #581c1c; 
            color: #fca5a5; 
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
            border: 1px solid #dc2626;
            font-size: 0.9rem;
        }
        /* Style pour l'historique */
        #historyList {
            list-style: none;
            padding: 0;
            max-height: 400px; /* Limite la hauteur de l'historique */
            overflow-y: auto;
        }
        #historyList::-webkit-scrollbar {
            width: 8px;
        }
        #historyList::-webkit-scrollbar-thumb {
            background-color: var(--muted);
            border-radius: 4px;
        }
        .current-user-tag {
            font-size: 1rem;
            color: #8b5cf6;
            margin-left: 20px;
            font-weight: bold;
        }
        .profile-data-box {
            background: var(--bg);
            border: 1px solid var(--border);
            padding: 15px;
            border-radius: var(--radius);
            margin-top: 15px;
            font-size: 0.9rem;
            word-break: break-all;
        }

        @media (max-width:600px){
            .hero{flex-direction:column; align-items:flex-start}
            header{flex-direction:column; align-items:flex-start}
            .wrap{padding:0 15px;}
            .encoder-controls{flex-direction: column;}
            #chatTerminal {
                height: 150px; 
            }
            body {
                padding-bottom: 200px;
            }
            .history-card { order: 1; } /* Mettre la carte d'historique en haut sur mobile */
            .grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="wrap">
        <header>
            <div class="brand">
                <span class="logo" aria-hidden="true"></span>
                <div>
                    <strong>CYBER-BASE</strong><div class="muted">PROTOCOLE EN LIGNE V6.1 (CLÉS ACTIVES)</div>
                </div>
            </div>
            <nav aria-label="Navigation principale">
                <ul>
                    <li><a href="#home">/ ACCUEIL</a></li>
                    <li><a href="#encoder">/ ENCODEUR</a></li>
                    <li><a href="#profile-mgmt">/ PROFIL</a></li>
                    <li><a href="#history-log">/ LOGS</a></li>
                    <li class="current-user-tag" id="currentUserDisplay">...</li>
                </ul>
            </nav>
        </header>

        <main>
            <div class="security-alert">
                [ALERTE SÉCURITÉ] Votre Clé API est visible dans le code source. Veuillez la restreindre aux domaines de votre projet GitHub et localhost via la console Google Cloud pour éviter les abus de quotas.
            </div>
            
            <section class="hero" id="home">
                <div class="left">
                    <h1>SYSTÈME EN LIGNE OPÉRATIONNEL</h1>
                    <p class="muted">Interface de base pour la navigation. Connecté à Firestore pour l'historique personnel chiffré.</p>
                    <a class="btn" href="#encoder">OUVRIR ENCODEUR</a>
                    <a class="btn" href="#history-log" style="background:#8b5cf6; box-shadow:0 0 15px rgba(139, 92, 246, 0.4);">VOIR LOGS</a>
                </div>
                <div style="min-width:180px; text-align:right;">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 120'%3E%3Crect rx='4' width='160' height='120' fill='%231f2937'/%3E%3Cpath d='M 10 30 L 150 30 L 150 100 L 10 100 Z' stroke='%2300ffc4' stroke-width='2' fill='none'/%3E%3Ccircle cx='30' cy='50' r='5' fill='%2300ffc4'/%3E%3Cpath d='M 40 50 L 140 50 M 30 70 L 130 70 M 50 90 L 110 90' stroke='%235e7087' stroke-width='1'/%3E%3Ctext x='80' y='65' font-family='Courier New' font-size='10' fill='%2300ffc4' text-anchor='middle'%3E[DONNÉES CHIFFRÉES]%3C/text%3E%3C/svg%3E" alt="Interface futuriste" aria-hidden="true" style="border-radius:4px;">
                </div>
            </section>

            <section class="grid" aria-label="Fonctionnalités du Système">
                <article class="card">
                    <h3>01. AUTHENTIFICATION SÉCURISÉE</h3>
                    <p class="muted">Connexion persistante via jeton. L'application gère l'ID sécurisé.</p>
                </article>
                <article class="card">
                    <h3>02. HISTORIQUE PRIVÉ</h3>
                    <p class="muted">L'historique des encodages est stocké de manière privée sur Firestore, lié à votre ID.</p>
                </article>
                <article class="card">
                    <h3>03. CHAT PUBLIC (ALIAS)</h3>
                    <p class="muted">Alias personnalisable pour une identification facile (ex: Votre-Nom-Ici).</p>
                </article>
            </section>

            <section id="encoder" class="card" aria-labelledby="encoder-title">
                <h3 id="encoder-title">MODULE DE CHIFFREMENT DE PROTOCOLE</h3>
                
                <form id="modeForm">
                    <label>
                        <span class="muted">Sélection du Mode de Transformation</span>
                        <select id="cipherMode">
                            <option value="caesar">01. Décalage Alphabétique (CÉSAR)</option>
                            <option value="vowel_sub">02. Substitution Voyelles-Numériques (A=1, E=2...)</option>
                        </select>
                    </label>
                </form>

                <div id="caesarSettings" class="mode-settings">
                    <h4 style="margin-top:0; color:var(--accent); font-size:1rem;">PARAMÈTRES CÉSAR</h4>
                    <label style="display: flex; align-items: center; gap: 10px;">
                        <span class="muted" style="white-space: nowrap;">Décalage de la Clé (0-25) :</span>
                        <input type="number" id="shiftAmount" value="1" min="0" max="25" style="width: 80px;">
                    </label>
                    
                    <div class="encoder-controls" style="margin-top: 15px;">
                        <button type="button" class="btn" id="saveShift">ACTIVER DÉCALAGE</button>
                        <button type="button" class="btn" id="resetShift" style="background:#4a5568; box-shadow:none;">RÉINITIALISER (DÉCALAGE 1)</button>
                    </div>
                    
                    <div class="cipher-info" style="margin-top: 15px;">
                        **Clé Active :** **Décalage** <span id="currentShiftDisplay" class="muted">1</span> | **A →** <span id="aTargetDisplay" class="muted">B</span>
                    </div>
                </div>

                <div id="vowelSettings" class="mode-settings" style="display: none;">
                    <h4 style="margin-top:0; color:var(--accent); font-size:1rem;">PARAMÈTRES VOYELLES</h4>
                    <div class="cipher-info">
                        **Règles de Substitution :** A=1, E=2, I=3, O=4, U=5 | Les consonnes et autres caractères sont inchangés.
                    </div>
                </div>
                
                <hr style="border-color: var(--border); margin: 20px 0;">

                <form id="codeForm">
                    <label>
                        <span class="muted">Séquence d'Entrée (TEXTE CLAIR / CODE)</span>
                        <textarea id="inputText" rows="4" placeholder="Tapez le message à transformer ici..."></textarea>
                    </label>
                    <div class="encoder-controls">
                        <button type="button" class="btn" id="encodeBtn">ENCODER SÉQUENCE</button>
                        <button type="button" class="btn" id="decodeBtn" style="background:#8b5cf6; box-shadow:0 0 15px rgba(139, 92, 246, 0.4);">DÉCODER SÉQUENCE</button>
                    </div>
                    <label>
                        <span class="muted">Séquence de Sortie (CODE TRANSFORMÉ / TEXTE CLAIR)</span>
                        <textarea id="outputText" rows="4" readonly placeholder="Le résultat apparaîtra ici..."></textarea>
                    </label>
                </form>
            </section>
            
            <section id="profile-mgmt" class="card" aria-labelledby="profile-title" style="margin-top: 30px;">
                <h3 id="profile-title">MODULE DE GESTION D'IDENTITÉ</h3>
                <p class="muted">Gérez votre Alias Public (pour le Chat) et visualisez votre ID Sécurisé unique.</p>

                <div class="profile-data-box">
                    **ID SÉCURISÉ (Firebase UID) :** <span id="secureIDDisplay" style="color:var(--accent);">...</span><br>
                    <span class="muted">Ceci est votre identifiant privé et permanent pour la base de données.</span>
                </div>
                
                <form id="aliasForm" style="margin-top: 20px;">
                    <label>
                        <span class="muted">Alias Public (Nom d'utilisateur mémorisable)</span>
                        <input type="text" id="profileAliasInput" placeholder="Saisissez votre nouvel alias..." minlength="3" required>
                    </label>
                    <button type="button" class="btn" id="saveProfileBtn">ENREGISTRER L'ALIAS</button>
                </form>
            </section>
            
            <section id="history-log" class="card history-card" aria-labelledby="history-title" style="margin-top: 30px;">
                <h3 id="history-title">LOG DES OPÉRATIONS (Historique Privé)</h3>
                <p class="muted">Liste de vos 50 dernières transformations de code, enregistrée sur Firestore.</p>
                <ul id="historyList">
                    <li style="color: var(--muted);">Chargement de l'historique...</li>
                </ul>
            </section>

        </main>

        <footer>
            &copy; <span id="year"></span> CYBER-BASE — Protocole Firebase.
        </footer>
    </div>
    
    <div id="chatTerminal">
        <div id="chatDisplay">
            <!-- Messages chargés par Firebase -->
        </div>
        <form id="chatInputForm">
            <input type="text" id="chatInput" placeholder="Saisir le message chiffré ou le code..." required>
            <button type="submit" class="btn" id="chatSendBtn">ENVOYER</button>
        </form>
    </div>
</body>
</html>
